{"version":3,"sources":["webpack:///webpack/bootstrap 337fbf244b9300385715","webpack:///./client/src/client.cjsx","webpack:///./client/src/styles/global.less","webpack:///./client/src/FileUploader.coffee","webpack:///./client/src/TestComponent.cjsx","webpack:///./client/src/styles/testComponent.less"],"names":[],"mappings":"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","file":"./client/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 337fbf244b9300385715\n **/","require './styles/global.less'\n\nFileUploader = require './FileUploader'\nTestComponent = require './TestComponent'\n\nclass MainContainer extends React.Component\n  constructor:()->\n    console.log \"run container constructor\"\n  render:->\n    React.createElement(\"div\", null,\n      React.createElement(TestComponent, {\"text\": (\"111\"), \"text2\": \"222\", \"obj\": ({key:\"val\"})})\n    )\n\nclass DungeonClient\n  constructor:()->\n    @fileUploader = new FileUploader\n    console.log \"inited\"\n    window.addEventListener \"dragover\",(e)=>\n      console.log \"over\"\n      e.preventDefault()\n    window.addEventListener \"dragleave\",(e)=>\n      console.log \"leave\"\n      e.preventDefault()\n    window.addEventListener \"drop\",(e)=>\n      e.stopPropagation()\n      e.preventDefault()\n      files = e.dataTransfer.files\n      @handleUploadFiles files\n    @listFiles()\n    ReactDOM.render React.createElement(MainContainer, null),$(\"#main-container\")[0]\n\n  listFiles:(dir = \"\")->\n    $.get \"/list/#{dir}\",(data)->\n      console.log \"got list data\",data\n    .fail (e)->\n      console.log \"error\",e\n\n  handleUploadFiles:(files)->\n    totalSize = 0\n    totalSize += f.size for f in files\n    console.log \"total file size is #{totalSize/1024/1024}MB\"\n    p = Promise.resolve()\n    Array::forEach.call files,(f)=>\n      p = p.then =>\n        @uploadFile(f)\n    p.then (e)->\n      console.log \"finished\"\n    .catch (e)->\n      console.error e.stack\n      console.error \"upload error\"\n\n  uploadFile:(file)->\n    new Promise (resolve, reject)->\n      console.log \"start upload #{file.name}\"\n      uploader = new FileUploader()\n      uploader.on \"complete\",->\n        resolve()\n      uploader.upload(file)\n\nnew DungeonClient()\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/cjsx-loader!./client/src/client.cjsx\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./client/src/styles/global.less\n ** module id = 1\n ** module chunks = 0\n **/","EventEmitter = Suzaku.EventEmitter\n\nsize =\n  kb:1024\n  mb:1024 * 1024\n\nmodule.exports =\n  class FileUploader extends EventEmitter\n    constructor:()->\n      @uploadApi = \"/upload\"\n      @checkApi = \"/check\"\n\n      @sliceSize = 3 * size.mb\n      #maxThreads = 3\n      @maxThreads = 2\n      @file = null\n      @availThreads = 0\n      @sliceCount = 0\n      @apiPath = null\n      @currentSlice = 0\n\n    setUploadApi:(@uploadApi)->\n    setCheckApi:(@checkApi)->\n\n    upload:(@file)->\n      #check\n      xhr = new XMLHttpRequest()\n      xhr.open \"GET\",\"#{@checkApi}?filename=#{@file.name}&size=#{@file.size}\"\n      xhr.send()\n      xhr.onload = ()=>\n        @doUpload()\n      xhr.onerror = (e)=>\n        console.error e\n        @emit \"error\",e\n\n    doUpload:->\n      # r = new FileReader()\n      # r.readAsBinaryString @file\n      # r.onload = (e)=>\n      #   console.log r.result\n      #   @showResult r.result\n      #   r = null\n      @sliceCount = Math.ceil(@file.size/@sliceSize)\n      @availThreads = @maxThreads\n      console.log \"sliceCount is #{@sliceCount}\"\n      @currentSlice = 0\n      console.log \"got file #{@file.name} total size #{@file.size}\"\n      console.log \"uploading using sliceSize #{@sliceSize} and #{@maxThreads} threads\"\n\n      @on \"sliceProgress\",(slice,percentage)=>\n        #TODO calculate total progress\n        @emit \"progress\"\n\n      @on \"sliceComplete\",(slice)=>\n        @availThreads += 1\n        if slice < (@sliceCount - 1)\n          #still has slice to upload\n          @uploadNextSlice()\n        else if @availThreads is @maxThreads\n          #all slice has been uploaded\n          @emit \"complete\"\n\n      @uploadNextSlice()\n\n    uploadNextSlice:()->\n      return unless @availThreads > 0\n      @availThreads -= 1\n      @uploadSlice @currentSlice\n      @currentSlice += 1\n      @uploadNextSlice()\n\n    uploadSlice:(slice)->\n      return unless slice < @sliceCount\n      name = @file.name\n      start = slice * @sliceSize\n      stop = (slice + 1) * @sliceSize - 1\n      #console.log \"upload slice\",slice,start,\"~\",stop,\"availThreads #{@availThreads}\"\n      if stop > (@file.size - 1) then stop = @file.size - 1\n      bolb = @file.slice start,stop + 1\n\n      reader = new FileReader()\n      reader.readAsBinaryString bolb\n      reader.onloadend = (e)=>\n        if reader.readyState is FileReader.DONE\n          @emit \"onload\"\n          #@showResult reader.result\n          @sendAsBinary xhr,reader.result\n          #@showResult reader.result\n          reader = null\n\n      xhr = new XMLHttpRequest()\n      xhr.upload.onprogress = (evt)=>\n        if evt.lengthComputable\n          percentage = Math.round((evt.loaded * 100) / evt.total);\n          @emit \"sliceProgress\",slice,percentage\n      xhr.upload.onload = (e)=>\n        @emit \"sliceComplete\",slice\n      xhr.upload.onerror = (error)=>\n        @emit \"error\",error\n      url = @uploadApi + \"?start=#{start}&stop=#{stop}&filename=#{name}\"\n      xhr.open \"POST\",url\n\n    sendAsBinary:(xhr, data)->\n      @xhr = new XMLHttpRequest()\n      parts = new Uint8Array(data.length)\n      for i in [0..data.length-1]\n        parts[i] = data[i].charCodeAt(0)\n      xhr.send(parts.buffer)\n\n    showResult:(res, label)->\n      markup = []\n      for n in [0..(res.length-1)]\n        aByte = res.charCodeAt(n)\n        byteStr = aByte.toString(16)\n        if byteStr.length < 2\n          byteStr = \"0\" + byteStr\n        markup.push(byteStr)\n      console.log markup.join(\" \")\n\n\n\n/** WEBPACK FOOTER **\n ** ./client/src/FileUploader.coffee\n **/","require './styles/testComponent.less'\n\nmodule.exports =\n  class TestComponent extends React.Component\n    constructor:()->\n      @state = {text:\"!!!!\"}\n    render:->\n      React.createElement(\"div\", {\"className\": \"test-component\"}, \"\"\"\n        Test Component\n\"\"\", React.createElement(\"p\", null, \"props:\", (JSON.stringify @props)),\n        React.createElement(\"p\", null, \"state:\", (JSON.stringify @state)),\n        (React.createElement(\"p\", {\"key\": (n)}, \"This line has been printed \", (n), \" times\") for n in [1..5])\n      )\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/cjsx-loader!./client/src/TestComponent.cjsx\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./client/src/styles/testComponent.less\n ** module id = 7\n ** module chunks = 0\n **/"],"sourceRoot":""}